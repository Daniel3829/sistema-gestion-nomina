{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
	<title>Registrarse | TecNómina</title>
	<link rel="shortcut icon" href="{% static 'images/logo_pestana.png' %}">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'fonts/font-awesome-4.7.0/css/font-awesome.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/animate/animate.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/css-hamburgers/hamburgers.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/select2/select2.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/util.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/login.css' %}">

	<style>
		.wrap-login100 {
		width: 960px;
		background: #fff;
		border-radius: 10px;
		overflow: hidden;

		display: -webkit-box;
		display: -webkit-flex;
		display: -moz-box;
		display: -ms-flexbox;
		display: flex;
		flex-wrap: wrap;
		justify-content: space-between;
		padding: 177px 130px 33px 95px;
		}

		/*------------------------------------------------------------------
		[  ]*/
		.login100-pic {
			width: 396px;
		}

		.login100-pic img {
			max-width: 100%;
		}
		.container-login100 {
			width: 100%;  
			min-height: 100vh;
			display: -webkit-box;
			display: -webkit-flex;
			display: -moz-box;
			display: -ms-flexbox;
			display: flex;
			flex-wrap: wrap;
			justify-content: center;
			align-items: center;
			padding: 15px;
			background: #9053c7;
			background: -webkit-linear-gradient(-135deg, #1a6479, #1d926f);
			background: -o-linear-gradient(-135deg, #1a6479, #1d926f);
			background: -moz-linear-gradient(-135deg, #1a6479, #1d926f);
			background: linear-gradient(-135deg, #1a6479, #1d926f);
		}
		.focus-input100 {
			display: block;
			position: absolute;
			border-radius: 25px;
			bottom: 0;
			left: 0;
			z-index: -1;
			width: 100%;
			height: 100%;
			box-shadow: 0px 0px 0px 0px;
			color: #1d926f;
		}
		.input100:focus + .focus-input100 + .symbol-input100 {
			color: #1d926f;
			padding-left: 28px;
		}
		.login100-form-btn {
			font-family: Montserrat-Bold;
			font-size: 15px;
			line-height: 1.5;
			color: #fff;
			text-transform: uppercase;

			width: 100%;
			height: 50px;
			border-radius: 25px;
			background: #1d926f;
			display: -webkit-box;
			display: -webkit-flex;
			display: -moz-box;
			display: -ms-flexbox;
			display: flex;
			justify-content: center;
			align-items: center;
			padding: 0 25px;

			-webkit-transition: all 0.4s;
			-o-transition: all 0.4s;
			-moz-transition: all 0.4s;
			transition: all 0.4s;
		}

		.login100-form-btn:hover {
			background: #1a6479;
		}
	</style>

</head>
<body>

	<div class="limiter">
		<div class="container-login100">
			<div class="wrap-login100">
				<div class="login100-pic js-tilt" data-tilt>
                <img src="{% static 'images/TecNomina2.png' %}" alt="IMG" class="p-t-20">
				</div>

				<form id="formRegistro" class="login100-form validate-form">
					<span class="login100-form-title">Registrate</span>

					<div class="wrap-input100">
						<input class="input100" type="email" name="correo" placeholder="Correo" required>
						<span class="symbol-input100"><i class="fa fa-envelope"></i></span>
					</div>

					<div class="wrap-input100">
						<input class="input100" type="text" name="nit" placeholder="NIT" required>
						<span class="symbol-input100"><i class="fa fa-hand-pointer-o"></i></span>
					</div>

					<div class="wrap-input100">
						<input class="input100" type="text" name="razon_social" placeholder="Razón social" required>
						<span class="symbol-input100"><i class="fa fa-user"></i></span>
					</div>

					<div class="wrap-input100">
						<input class="input100" type="password" name="contraseña" id="password" placeholder="Contraseña" required>
						<span class="symbol-input100"><i class="fa fa-lock"></i></span>
					</div>

					<div class="container-login100-form-btn">
						<button class="login100-form-btn" type="submit">Registrarse</button>
					</div>

					<div class="text-center p-t-116">
						<a class="txt2" href="{% url 'login' %}">
							Inicia sesión <i class="fa fa-long-arrow-right m-l-5"></i>
						</a>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script>
		document.getElementById('formRegistro').addEventListener('submit', async (e) => {
			e.preventDefault();

			const data = Object.fromEntries(new FormData(e.target));
			const contraseña = data.contraseña;

			const errores = [];

			if (contraseña.length < 8) {
				errores.push("La contraseña debe tener al menos 8 caracteres.");
			}
			if (!/[A-Z]/.test(contraseña)) {
				errores.push("Debe contener al menos una letra mayúscula.");
			}
			if (!/[a-z]/.test(contraseña)) {
				errores.push("Debe contener al menos una letra minúscula.");
			}
			if (!/[0-9]/.test(contraseña)) {
				errores.push("Debe incluir al menos un número.");
			}
			if (!/[!@#$%^&*(),.?\":{}|<>]/.test(contraseña)) {
				errores.push("Debe contener al menos un carácter especial (ej: @, #, $, %...).");
			}

			// Mostrar alerta si hay errores
			if (errores.length > 0) {
				await Swal.fire({
					icon: 'warning',
					title: 'Contraseña inválida',
					html: errores.map(e => `• ${e}`).join('<br>'),
					confirmButtonText: 'Entendido',
					confirmButtonColor: '#3085d6',
				});
				return;
			}

			try {
				const res = await fetch('/registrar/', {
				method: 'POST',
				headers: { 
					'Content-Type': 'application/json',
					'X-CSRFToken': csrftoken
				},
				body: JSON.stringify(data)
			});

				const result = await res.json();

				if (res.ok) {
					await Swal.fire({
						icon: 'success',
						title: 'Registro exitoso',
						text: 'Tu cuenta ha sido creada correctamente.',
						confirmButtonText: 'Iniciar sesión',
						confirmButtonColor: '#28a745'
					});
					window.location.href = "{% url 'login' %}";
				} else {
					await Swal.fire({
						icon: 'error',
						title: 'Error',
						text: result.error || 'Error al registrar.'
					});
				}
			} catch (error) {
				console.error("Error al registrar:", error);
				await Swal.fire({
					icon: 'error',
					title: 'Error inesperado',
					text: 'Ocurrió un problema al intentar registrarse. Intenta nuevamente.'
				});
			}
		});
	</script>

	<script>
		function getCookie(name) {
			let cookieValue = null;
			if (document.cookie && document.cookie !== '') {
				const cookies = document.cookie.split(';');
				for (let cookie of cookies) {
					cookie = cookie.trim();
					if (cookie.startsWith(name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}
		const csrftoken = getCookie('csrftoken');
	</script>

	<script src="{% static 'vendor/jquery/jquery-3.2.1.min.js' %}"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="{% static 'vendor/bootstrap/js/popper.js' %}"></script>
	<script src="{% static 'vendor/bootstrap/js/bootstrap.min.js' %}"></script>
	<script src="{% static 'vendor/select2/select2.min.js' %}"></script>
	<script src="{% static 'vendor/tilt/tilt.jquery.min.js' %}"></script>
	<script>
		$('.js-tilt').tilt({ scale: 1.1 });
	</script>
	<script src="{% static 'js/main.js' %}"></script>

</body>
</html>
